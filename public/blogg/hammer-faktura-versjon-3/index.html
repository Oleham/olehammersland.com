<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://www.olehammersland.com/images/favicon.png" />
<title>Hammer Faktura versjon 3 | Ole Hammersland</title>
<meta name="title" content="Hammer Faktura versjon 3" />
<meta name="description" content="Jeg har oppdatert Hammer Faktura igjen! I denne bloggposten g√•r jeg gjennom hva som er nytt, og gir litt dokumentasjon p√• hvordan man kan bruke programmet.
Nytt i Hammer Faktura versjon 3:  St√∏tte for sqlite-database muliggj√∏r lagring av fakturaposter, kunder, bankinformasjon og fakturaer. Kommandolinjeverkt√∏y for direkte samhandling med databasen. Wrapper-funksjoner som forenkler prosessen med √• opprette faktuaene. St√∏tte for enkel flerspr√•klighet, slik at jeg kan skrive ut engelske fakturaer.  De tidligere utgavene av Hammer Faktura har kun hatt st√∏tte for √• opprette fakturaene." />
<meta name="keywords" content="automatisering,bash,effektivisering,enkeltpersonforetak,oversettelse,python," />


<meta property="og:title" content="Hammer Faktura versjon 3" />
<meta property="og:description" content="Jeg har oppdatert Hammer Faktura igjen! I denne bloggposten g√•r jeg gjennom hva som er nytt, og gir litt dokumentasjon p√• hvordan man kan bruke programmet.
Nytt i Hammer Faktura versjon 3:  St√∏tte for sqlite-database muliggj√∏r lagring av fakturaposter, kunder, bankinformasjon og fakturaer. Kommandolinjeverkt√∏y for direkte samhandling med databasen. Wrapper-funksjoner som forenkler prosessen med √• opprette faktuaene. St√∏tte for enkel flerspr√•klighet, slik at jeg kan skrive ut engelske fakturaer.  De tidligere utgavene av Hammer Faktura har kun hatt st√∏tte for √• opprette fakturaene." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.olehammersland.com/blogg/hammer-faktura-versjon-3/" /><meta property="og:image" content="https://www.olehammersland.com/images/share.png"/><meta property="article:section" content="blogg" />
<meta property="article:published_time" content="2021-03-21T18:16:42+01:00" />
<meta property="article:modified_time" content="2021-03-21T18:16:42+01:00" />




<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.olehammersland.com/images/share.png"/>

<meta name="twitter:title" content="Hammer Faktura versjon 3"/>
<meta name="twitter:description" content="Jeg har oppdatert Hammer Faktura igjen! I denne bloggposten g√•r jeg gjennom hva som er nytt, og gir litt dokumentasjon p√• hvordan man kan bruke programmet.
Nytt i Hammer Faktura versjon 3:  St√∏tte for sqlite-database muliggj√∏r lagring av fakturaposter, kunder, bankinformasjon og fakturaer. Kommandolinjeverkt√∏y for direkte samhandling med databasen. Wrapper-funksjoner som forenkler prosessen med √• opprette faktuaene. St√∏tte for enkel flerspr√•klighet, slik at jeg kan skrive ut engelske fakturaer.  De tidligere utgavene av Hammer Faktura har kun hatt st√∏tte for √• opprette fakturaene."/>



<meta itemprop="name" content="Hammer Faktura versjon 3">
<meta itemprop="description" content="Jeg har oppdatert Hammer Faktura igjen! I denne bloggposten g√•r jeg gjennom hva som er nytt, og gir litt dokumentasjon p√• hvordan man kan bruke programmet.
Nytt i Hammer Faktura versjon 3:  St√∏tte for sqlite-database muliggj√∏r lagring av fakturaposter, kunder, bankinformasjon og fakturaer. Kommandolinjeverkt√∏y for direkte samhandling med databasen. Wrapper-funksjoner som forenkler prosessen med √• opprette faktuaene. St√∏tte for enkel flerspr√•klighet, slik at jeg kan skrive ut engelske fakturaer.  De tidligere utgavene av Hammer Faktura har kun hatt st√∏tte for √• opprette fakturaene."><meta itemprop="datePublished" content="2021-03-21T18:16:42+01:00" />
<meta itemprop="dateModified" content="2021-03-21T18:16:42+01:00" />
<meta itemprop="wordCount" content="1687"><meta itemprop="image" content="https://www.olehammersland.com/images/share.png"/>
<meta itemprop="keywords" content="automatisering,bash,effektivisering,enkeltpersonforetak,oversettelse,python," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>

  :root {
    --main-color: rgb(35, 19, 253);
}

  @import url('fonts/inter.css');
    html { 
      font-family: 'Inter', sans-serif; 
    }
  @supports (font-variation-settings: normal) {
    html { 
      font-family: 'Inter var', sans-serif; 
    }
  }

  body {
    margin: auto;
    font-size: 1.2rem;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

 .logo-icon {
    min-width: 100px;
    margin-right: 10px;
  }

  .logo-box {
    display:flex;
    width: 100%;
  }

  .title span {
    font-weight: 400;
  }

  #main-nav a {
    font-size: 1.5rem;
    margin-right: 5px;
    padding-right: 10px;
    color:#444;
    text-decoration: none;
    border-right: 2px solid var(--main-color);
  }

  #main-nav a:hover {
    color:rgb(145, 139, 139)
  }

  #main-nav a:last-of-type {
    border-right: none;
  }

  #burger {
    display: none;
    margin: 10px;
  }

  .burger-line {
    height: 5px;
    width: 35px;
    background-color:var(--main-color);
    margin-bottom: 5px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

  .blog-posts a {
    text-decoration: none;
    color:#444;
  }

  .blog-posts h3 {
    border-bottom: 1px solid var(--main-color);
  }

  .blog-posts h3::first-letter {
    color:var(--main-color);
  }

  .blog-posts a:hover, .blog-posts h3:hover {
    color:rgb(145, 139, 139);
  }

  #pagination {
    margin: auto;
    width: 100%;
    align-items: center;
    font-size: 1.5rem;
    border: 1px solid var(--main-color);
    margin-bottom: 20px;
    margin-top: 20px;
    text-align: center;
  }
  
  #pagination span {
    padding-right: 20px;
    padding-left: 20px;
  }

  #pagination button {
    border: none;
    background-color: inherit;
    font-size: inherit;
    color: inherit;
    cursor: pointer;
  }

  div#TableOfContents {
    padding-top: 10px; 
  }
  #TableOfContents li {
    list-style: circle;
  }

  .blog-teaser  {
    border: 3px solid var(--main-color);
    border-radius: 5%;
    padding: 20px;
    background-color: lightblue;
    box-shadow: 5px -5px 10px black;
    margin-bottom: 15px;
  }

  .blog-teaser h3 {
    text-align: center;
  }

  @media screen and (max-width: 700px) {
    #burger {
      display:block
    }

    #main-nav {
      display: absolute;
      transform: translateY(calc(-100vh));
      height: 5px;
      transition: 1s;
      border-left: 2px solid var(--main-color);
      padding-left: 10px;
    }

    #main-nav a {
      border:none;
    }

    #main-nav.open-burger {
      display: flex;
      height: unset;
      flex-direction: column;
      transition: 1s;
      font-size: 2rem;
      transform: translateY(0);
    }

    .open-burger .burger-line {
      margin:none;
      transform: none;
    }

   .open-burger #line1 {
      transform: rotate(45deg) translateY(6px) translateX(1px);
      margin:none;
      transition: 1s ease-out;
    }
    .open-burger #line2 {
      display:none;
    }
    .open-burger #line3 {
      transform: rotate(-45deg) translateY(-6px);
      margin:none;
      transition: 1s ease-out;
    }
  }



  @media screen and (max-width: 400px) {
    .logo-box {
      flex-direction: column;
    }

    .title {
      border-bottom: 5px solid var(--main-color);
    }

    .logo-icon {
      display:none;
    }

    #burger {
      align-self: flex-end;
    }
  }
</style></head>

<body>
  <header>
<div class="logo-box">
  <a href="/" class="title">
    <img class="logo-icon" src="/images/book.png">
  </a>
  <h2>Ole Hammersland</h2>
  <div id="burger">
      <div class="burger-line" id="line1"></div>
      <div class="burger-line" id="line2"></div>
      <div class="burger-line" id="line3"></div>
  </div>
</div>
<nav id="main-nav"><a href="/">Hjem</a>

<a href="/om/">Om</a>

<a href="/spr%C3%A5ktjenester/">Spr√•ktjenester</a>

<a href="/sykkel/">Sykkel</a>

<a href="/bokhylla/">üìö</a>


<a href="/blogg">Blogg</a>

</nav>

</header>
  <main>



<div id="TableOfContents">
<p><strong>Innhold:</strong></p>
<nav id="TableOfContents">
  <ol>
    <li><a href="#nytt-i-hammer-faktura-versjon-3">Nytt i Hammer Faktura versjon 3:</a></li>
    <li><a href="#dokumentasjon">Dokumentasjon</a>
      <ol>
        <li><a href="#hurtigstart">Hurtigstart</a></li>
        <li><a href="#samhandling-med-databasen">Samhandling med databasen</a></li>
        <li><a href="#skape-og-bruke-fakturageneratoren">Skape og bruke fakturageneratoren</a></li>
        <li><a href="#navn-og-kontrakter">Navn og kontrakter</a></li>
        <li><a href="#kommandolinjeverkt√∏y">Kommandolinjeverkt√∏y</a></li>
      </ol>
    </li>
  </ol>
</nav>

</div>
<h1>Hammer Faktura versjon 3</h1>
<p>
  <i>
    <time datetime='2021-03-21' pubdate>
      F√∏rst publisert: 21.03.2021
    </time>
  </i>
</p>


<content>
  <p>Jeg har oppdatert Hammer Faktura igjen! I denne bloggposten g√•r jeg gjennom hva som er nytt, og gir litt dokumentasjon p√• hvordan man kan bruke programmet.</p>
<h2 id="nytt-i-hammer-faktura-versjon-3">Nytt i Hammer Faktura versjon 3:</h2>
<ul>
<li>St√∏tte for sqlite-database muliggj√∏r lagring av fakturaposter, kunder, bankinformasjon og fakturaer.</li>
<li>Kommandolinjeverkt√∏y for direkte samhandling med databasen.</li>
<li>Wrapper-funksjoner som forenkler prosessen med √• opprette faktuaene.</li>
<li>St√∏tte for enkel flerspr√•klighet, slik at jeg kan skrive ut engelske fakturaer.</li>
</ul>
<p>De tidligere utgavene av Hammer Faktura har kun hatt st√∏tte for √• opprette fakturaene. Fakturaene har blitt opprettet ved √• kj√∏re data fra eksterne kilder gjennom programmet. N√• legger jeg til st√∏tte for √• lagre all relevant informasjon i en egen database. En database er i prinsippet som et Excel-regneark: den inneholder ulike tabeller som er knyttet sammen. Man kan samhandle med databasen med sp√∏rringsspr√•ket SQL, eller med andre verkt√∏y og drivere.</p>
<p>Det er det som er fint med √• lagre all informasjonen i en SQL-database: det er en ganske agnostisk m√•te √• lagre data p√•. Det finnes utallige m√•ter √• hente dataene og kj√∏re regnestykker og analyser p√• dem, og det er ikke knyttet til noe spesielt program eller programmeringsspr√•k. Den sentraliserte datastrukturen burde tilfredsstille alle behovene mine for regnskapsf√∏ring: f.eks kan jeg regne ut hvor mye penger jeg tjente i l√∏pet av en viss tidsperiode, hvor mye MVA jeg har betalt, hvor mange oppdrag jeg har f√•tt fra kunde X, osv.</p>
<p>Hammer Faktura har f√•tt en egen modul, <code>hfdb</code>(Hammer Faktura -database), som er ansvarlig for √• samhandle med databasen og knytte informasjonen der sammen med programmet mitt.</p>
<p>Hammer Faktura kan n√• dessuten <a href="#kommandolinjeverkt%C3%B8y">kj√∏res direkte som et skript</a> med &ldquo;-m&rdquo; flagget til Python.</p>
<h2 id="dokumentasjon">Dokumentasjon</h2>
<h3 id="hurtigstart">Hurtigstart</h3>
<p>Last ned modulen:</p>
<pre tabindex="0"><code>git clone https://github.com/Oleham/hammer_faktura.git
</code></pre><p>Opprett en tom database i n√•v√¶rende mappe. Navnet vil alltid v√¶re <code>hammer_faktura.db</code>.</p>
<pre tabindex="0"><code>$ python3 -m hammer_faktura.create_tables
</code></pre><p>Importer database-modulen <code>hammerfaktura.hfdb</code> i skriptet ditt. Den inneholder funksjoner for √• samhandle med databasen.
Lag en enkel faktura for ett oppdrag:</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#cd00cd">from</span> hammer_faktura <span style="color:#cd00cd">import</span> hfdb

<span style="color:#000080"># Legg til en kunde i databasen.</span>
client_pk <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>addClient(<span style="color:#cd0000">&#34;Kunde&#34;</span>, 
                            <span style="color:#cd0000">&#34;934 343 343&#34;</span>,
                            <span style="color:#cd0000">&#34;Adresseveien 4, 1234 Oslo&#34;</span>, 
                            <span style="color:#cd00cd">0.25</span>, 
                            <span style="color:#cd0000">&#34;NOK&#34;</span>)

<span style="color:#000080"># Legg til bankinformasjonen din i databasen.</span>
bank_pk <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>addBank(<span style="color:#cd0000">&#34;123.2312.2323&#34;</span>, 
                        <span style="color:#cd0000">&#34;NO87234233&#34;</span>,
                        <span style="color:#cd0000">&#34;NONKIRE&#34;</span>,
                        <span style="color:#cd0000">&#34;Banken AS&#34;</span>)

<span style="color:#000080"># Verdien p√• jobben</span>
value <span style="color:#39c">=</span> <span style="color:#cd00cd">2320.3</span>

generator <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>quickGeneratorFromItem(<span style="color:#cd0000">&#34;01.01.1990&#34;</span>,
                                        <span style="color:#cd0000">&#34;ID-231&#34;</span>,
                                        <span style="color:#cd0000">&#34;Oversettelse kokebok&#34;</span>,
                                        value,
                                        client_pk, 
                                        bank_pk)

invoice <span style="color:#39c">=</span> generator<span style="color:#39c">.</span>makeInvoiceBody()

<span style="color:#cdcd00">with</span> <span style="color:#cd00cd">open</span>(<span style="color:#cd0000">&#34;faktura.html&#34;</span>, <span style="color:#cd0000">&#34;w&#34;</span>) <span style="color:#cdcd00">as</span> f:
    f<span style="color:#39c">.</span>write(invoice)

</code></pre></div><p><code>hfdb.quickGeneratorFromItem</code> lar oss legge til en jobb i databasen og umiddelbart skape en faktura for den. Med <code>hfdb.quickGeneratorFromList</code> kan vi p√• samme m√•te legge inn flere oppdrag og umiddelbart skape en faktura.</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">jobber <span style="color:#39c">=</span> [{<span style="color:#cd0000">&#34;dato&#34;</span>: <span style="color:#cd00cd">1615968966</span>,
    <span style="color:#cd0000">&#34;id&#34;</span>: <span style="color:#cd0000">&#34;1234&#34;</span>,
    <span style="color:#cd0000">&#34;beskrivelse&#34;</span>: <span style="color:#cd0000">&#34;Oversettelse avis&#34;</span>,
    <span style="color:#cd0000">&#34;netto&#34;</span>: <span style="color:#cd00cd">320.12</span>
    }, 
    {<span style="color:#cd0000">&#34;dato&#34;</span>: <span style="color:#cd00cd">1615968100</span>,
    <span style="color:#cd0000">&#34;id&#34;</span>: <span style="color:#cd0000">&#34;5678&#34;</span>,
    <span style="color:#cd0000">&#34;beskrivelse&#34;</span>: <span style="color:#cd0000">&#34;Korrekturlesning 4 timer&#34;</span>,
    <span style="color:#cd0000">&#34;netto&#34;</span>: <span style="color:#cd00cd">1030.20</span>
    }, 
    {<span style="color:#cd0000">&#34;dato&#34;</span>: <span style="color:#cd00cd">1616328966</span>,
    <span style="color:#cd0000">&#34;id&#34;</span>: <span style="color:#cd0000">&#34;ABCDF&#34;</span>,
    <span style="color:#cd0000">&#34;beskrivelse&#34;</span>: <span style="color:#cd0000">&#34;Kokebok&#34;</span>,
    <span style="color:#cd0000">&#34;netto&#34;</span>: <span style="color:#cd00cd">365.06</span>,
    <span style="color:#cd0000">&#34;vat&#34;</span>: <span style="color:#cd00cd">0.15</span> <span style="color:#000080"># obs!</span>
    } 
]

generator <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>quickGeneratorFromList(jobber, client_pk, bank_pk)

invoice <span style="color:#39c">=</span> generator<span style="color:#39c">.</span>makeInvoiceBody()
</code></pre></div><p>Merk at det er valgfritt √• oppgi en mva-sats p√• enkeltjobbene. Om det ikke oppgis noen mva-sats, vil standardsatsen for den aktuelle kunden velges (i dette tilfellet 0.25, alts√• 25 %)</p>
<h3 id="samhandling-med-databasen">Samhandling med databasen</h3>
<p>La oss ta en titt p√• hva som skjer i bakgrunnen. Da er det nyttig √• f√∏rst kaste et blikk p√• strukturen til databasen:</p>
<p><img src="/images/blogg/hammer_faktura_database.jpg" alt="En skjematisk fremstilling av databasen"></p>
<p>Som vi ser, best√•r databasen av fire tabeller: invoices, invoice_items, clients og banks. Den viktigste tabellen som knytter alle tabellene sammen, er invoices. Det er alltid knyttet en client og en bank til hver invoice, i et √©n-til-√©n-forhold. Samtidig kan flere poster i invoice_items, som representerer de enkelte jobbene, v√¶re knyttet til en invoice i et mange-til-√©n-forhold (en faktura kan inneholde flere fakturaposter).</p>
<p>I forrige avsnitt viste jeg hvordan man veldig raskt kan skape fakturaer med <code>hfdb.quickGeneratorFromItem</code> og <code>hfdb.quickGeneratorFromList</code>. Dette er faktisk to wrapper-funksjoner som ¬´wrapper¬ª en rekke funksjoner for samhandling med databasen, med den hensikt √• gj√∏re det s√• enkelt s√• mulig √• opprette en faktura hurtig. De gj√∏r to ting med informasjonen som gis dem: de legger dem til i databasen, og s√• returnerer de en <code>hammer_faktura.Generator</code>, som vi kan bruke for √• skape en faktura.</p>
<p>La oss ta en titt p√• hva som skjer i bakgrunnen n√•r vi bruker disse wrapper-funksjonene:</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#cd00cd">from</span> hammer_faktura <span style="color:#cd00cd">import</span> hfdb

jobber <span style="color:#39c">=</span> [{<span style="color:#cd0000">&#34;dato&#34;</span>: <span style="color:#cd00cd">1615968100</span>,
    <span style="color:#cd0000">&#34;id&#34;</span>: <span style="color:#cd0000">&#34;5678&#34;</span>,
    <span style="color:#cd0000">&#34;beskrivelse&#34;</span>: <span style="color:#cd0000">&#34;Korrekturlesning 4 timer&#34;</span>,
    <span style="color:#cd0000">&#34;netto&#34;</span>: <span style="color:#cd00cd">1030.20</span>,
    <span style="color:#cd0000">&#34;client&#34;</span>: client_pk  <span style="color:#000080"># obs!</span>
    },
    [<span style="">‚Ä¶</span>]

<span style="color:#cdcd00">for</span> jobb <span style="color:#cdcd00">in</span> jobber:
    hfdb<span style="color:#39c">.</span>addItem(jobb)  

invoice_number <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>addInvoice(client_pk, bank_pk, 
                    dato<span style="color:#39c">=</span>timestamp, 
                    frist<span style="color:#39c">=</span><span style="color:#cd00cd">30</span>, 
                    language<span style="color:#39c">=</span><span style="color:#cd0000">&#34;NO&#34;</span>)
                                                                                     
hfdb<span style="color:#39c">.</span>assignItemsByDate(invoice_number, 
                    <span style="color:#cd0000">&#34;16.03.2021&#34;</span>,
                    <span style="color:#cd0000">&#34;21.03.2021&#34;</span>)  
  
</code></pre></div><p>I dette eksempelet lagrer vi jobbene manuelt i databasen med <code>hfdb.addItem()</code>. Jobbene lagres i tabellen invoice_items. Merk at vi n√• er n√∏dt til √• oppgi hvem som er client for hver enkelt jobb, siden vi n√• legger til jobbene ¬´uavhengig¬ª av en faktura.</p>
<p><code>hfdb.addInvoice()</code> lagrer en faktura i databasen, i tabellen invoices. Det er kun n√∏dvendig √• oppgi en kunde og bankinformasjon. Vi kan ogs√• oppgi f√∏lgende: en egendefinert fakturadato (som timestamp ‚Äì standard er dagens dato), en egendefinert frist eller velge et annet spr√•k enn norsk. I bakgrunnen blir det automatisk generert et fakturanummer som returneres og lagres i variabelen invoice_number.</p>
<p><code>hfdb.assignItemsByDate()</code> knytter s√• en rekke invoice_item til en invoice i et √©n-til-flere-forhold. Dette forholdet etableres f√∏rst n√•r vi kj√∏rer denne funksjonen ‚Äì fakturaposter som enn√• ikke er blitt ber√∏rt, vil ikke v√¶re tilknyttet noen faktura i det hele tatt. Argumentene er fakturanummeret det gjelder og et datospenn. Alle poster i invoice_items med samme client som fakturaen og leveringsdato innenfor tidsspennet, blir knyttet til fakturaen.</p>
<h3 id="skape-og-bruke-fakturageneratoren">Skape og bruke fakturageneratoren</h3>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="">‚Ä¶</span>]

generator <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>makeGenerator(invoice_number)  

body <span style="color:#39c">=</span> generator<span style="color:#39c">.</span>makeInvoiceBody()

<span style="color:#cdcd00">with</span> <span style="color:#cd00cd">open</span>(<span style="color:#cd0000">&#34;faktura.html&#34;</span>, <span style="color:#cd0000">&#34;w&#34;</span>) <span style="color:#cdcd00">as</span> f:
    f<span style="color:#39c">.</span>write(body)

</code></pre></div><p>Til slutt skaper vi generatoren med funksjonen <code>hfdb.makeGenerator()</code>. Funksjonen tar et fakturanummer som argument, og forutsetter at det finnes poster i tabellen invoice_items som er knyttet til dette fakturanummeret. Det henter s√• all informasjon om client, bank, og invoice_items som er knyttet til fakturaen, og lagrer det i generatoren.</p>
<p>Generatoren er en klasse med tre underklasser, client, invoice og bank, som til sammen inneholder all relevant informasjon om fakturaen fra databasen. Den har ogs√• en (wrapper-)metode <code>hammer_faktura.Generator.makeInvoiceBody</code> som returnerer et html-dokument som en string. <a href="/blogg/fakturaer-del-to/#1-initialisere-kunde-bank-og-faktura">Se min forrige post for mer informasjon om Generator-objektet</a>. <code>hfdb.makeGenerator()</code> er alts√• en n√∏kkelfunksjon som forvandler en post i tabellen invoices til en python-klasse vi kan bruke programmet v√•rt.Vi kan  manuelt overskrive feltene til hammer_faktura.Generator-objektet, f.eks slik:</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">generator <span style="color:#39c">=</span> hfdb<span style="color:#39c">.</span>quickGeneratorFromList(jobber, client_pk, bank_pk)

generator<span style="color:#39c">.</span>invoice<span style="color:#39c">.</span>language <span style="color:#39c">=</span> <span style="color:#cd0000">&#34;en&#34;</span>        <span style="color:#000080"># endre spr√•k.</span>
generator<span style="color:#39c">.</span>invoice<span style="color:#39c">.</span>forfall <span style="color:#39c">=</span> <span style="color:#cd0000">&#34;01.01.2020&#34;</span> <span style="color:#000080"># overskrive forfallsdatoen</span>
generator<span style="color:#39c">.</span>client<span style="color:#39c">.</span>vat <span style="color:#39c">=</span> <span style="color:#cd00cd">0.3</span>               <span style="color:#000080"># overskrive mva-satsen</span>
generator<span style="color:#39c">.</span>invoice_items[<span style="color:#cd00cd">0</span>][<span style="color:#cd0000">&#34;beskrivelse&#34;</span>] <span style="color:#39c">+=</span> <span style="color:#cd0000">&#34; m.m.&#34;</span> <span style="color:#000080"># endre en jobb</span>
</code></pre></div><p>Man skal imidlertid ha en ganske god grunn for √• gj√∏re det, for endringene vil ikke gjenspeiles i databasen, kun p√• fakturaen man s√• genererer. Om man vil endre p√• innholdet i databasen, m√• det gj√∏re med funksjonene i <code>hfdb</code>-modulen.</p>
<h3 id="navn-og-kontrakter">Navn og kontrakter</h3>
<p>I dette prosjektet har jeg blitt inspirert av boken jeg leser for tiden, <em>The Go Programming Language</em>. Forfatterne av boken g√•r n√∏ye gjennom navnekonvensjonene i Go, og det har v√¶rt l√¶rerikt √• tiln√¶rme seg en lignende konsekvenstenking n√•r jeg definerer funksjoner og oppf√∏rsel i dette prosjektet.</p>
<p>Som den oppmerksomme leser kanskje har f√•tt med seg, finnes det en rekke funksjoner i Hammer Faktura med prefikset ¬´add¬ª, etterfulgt av et objekt i singular. ¬´addInvoice¬ª, ¬´addItem¬ª, ¬´addClient¬ª og ¬´addBank¬ª. Alle disse korresponderer med en tabell i databasen.</p>
<p>Wrapper-funksjonene starter med ¬´quick¬ª og gir allerede i navnet et hint om hvilke argumenter som m√• f√∏lge: ¬´quickGeneratorFromList¬ª eller ¬´quickGeneratorFromItem¬ª.</p>
<p>Hva er poenget? Hvorfor ikke bare kalle funksjonene for ¬´funksjon1¬ª eller ¬´asdfgh¬ª?</p>
<p>Vel, ved √• skape lignende navn og lignende oppf√∏rsel blir det lettere √• lese og forst√• koden. Det skaper en slags ¬´kontrakt¬ª mellom brukeren og modulen. Konsekvenstenkingen vil ogs√• gj√∏re det lettere for meg √• plukke opp koden p√• et senere tidspunkt. Jeg har for eksempel bestemt at alle ¬´addX¬ª-funksjonene legger til noe i databasen, og at de returnerer prim√¶rn√∏kkelen for den posten de nettopp la til. Dette skal da gjennomf√∏res konsekvent, selv om jeg som regel ikke bruker denne returverdien til noe, unntatt i ¬´addInvoice¬ª. Om jeg i fremtiden vil bruke Hammer Faktura p√• en ny m√•te, vet jeg imidlertid at det er en mulighet. Det vil ogs√• gj√∏re det lettere √• skumme gjennom listen over funksjoner og se hvilke nye funksjoner som kan legges til. Kanskje vil jeg legge til en funksjon kalt ¬´assignItemsById¬ª for √• knytte fakturaposter til fakturaer etter jobb-id, i stedet for etter et datospenn med ¬´assignItemsByDate¬ª.</p>
<ul>
<li>def addItem(values)</li>
<li>def addClient(navn, org_nr, adresse, vat, valuta)</li>
<li>def addBank(konto, iban, bic, bank)</li>
<li>def addInvoice(client, bank, dato=int(time.time()), frist=30, language=&ldquo;NO&rdquo;)</li>
<li>def assignItemsByDate(invoice, _from, to)</li>
<li>def makeGenerator(id)</li>
<li>def quickGeneratorFromList(items, client, bank)</li>
<li>def quickGeneratorFromItem(dato, id, beskrivelse, netto, client, bank)</li>
</ul>
<p>N√•r jeg ser p√• listen over funksjoner, vil jeg si at det ser ganske forst√•elig ut (selvskryt skal man lytte til, for det kommer fra hjertet)! üò¨</p>
<p>I henhold til SQL-konvensjoner er tabellene databasen skrevet i s√•kalt <em>snake case</em> i stedet for <em>camel case</em>, alts√• <em>slik_som_dette</em> i stedet for <em>p√•DenneM√•ten</em>. Dessuten st√•r tabellnavn alltid i flertall.</p>
<h3 id="kommandolinjeverkt√∏y">Kommandolinjeverkt√∏y</h3>
<p>Jeg har begynt √• lage st√∏tte for √• bruke Hammer Faktura i kommandolinjen. Inntil videre har jeg konsentrert meg spesielt om de operasjonene som ikke m√• gj√∏res s√• ofte: da tenker jeg p√• det √• legge til en ny kunde eller en ny bankforbindelse. Jeg har ogs√• st√∏tte for √• legge til en enkelt jobb i invoice_item.</p>
<p>Slik kan Hammer Faktura brukes i kommandolinjen:</p>
<pre tabindex="0"><code>$ python3 -m hammer_faktura

Usage: python3 -m hammer_faktura [-l/-a] &lt;args&gt;

        list: -l or --list (table name in plural, i.e. &quot;invoices&quot;)
        add: -a or --add (item, bank, client or invoice)

$ python3 -m hammer_faktura -l clients

3       Navn     Org        Adresse     0.25    NOK
4       Test     234234     Adresse     0.25    SEK
5       Navn     43443      Adresse     0.25    SEK
6       Probe    234233     Adresse     0.25    SEK

$ python3 -m hammer_faktura -a client &quot;En ny kunde&quot; 94233465 &quot;Bakketoppen 4, 4567 Kristiansand&quot; 0.25 NOK

        Name: En ny kunde
        Org_nr: 94233465
        Adresse: Bakketoppen 4, 4567 Kristiansand
        VAT rate: 0.25
        Valuta: NOK

Type Y to add client (Y)
Y
Added new client: En ny kunde, 94233465, Bakketoppen 4, 4567 Kristiansand, 0.25, NOK

$ python3 -m hammer_faktura -l clients

3       Navn            Org        Adresse               0.25    NOK
4       Test            234234     Adresse               0.25    SEK
5       Navn            43443      Adresse               0.25    SEK
6       Probe           234233     Adresse               0.25    SEK      
8       En ny kunde     94233465   Bakketoppen 4, 
                                   4567 Kristiansand     0.25    NOK
</code></pre><p>Neste punkt p√• programmet vil v√¶re st√∏tte for √• lage en faktura direkte i kommandolinjen, p√• samme m√•te som <code>hfdb.quickGeneratorFromItem</code>.</p>
<p><a href="https://github.com/Oleham/hammer_faktura">Se Hammer Faktura p√• Github!</a></p>

</content>


<hr>
<p style="text-align: center;"><a href="/blogg/">Tilbake til bloggoversikten</a></p>
<h4>Tagger:</h4>
<p>
  
  <a href="https://www.olehammersland.com/blogg/automatisering/">#automatisering</a>
  
  <a href="https://www.olehammersland.com/blogg/bash/">#bash</a>
  
  <a href="https://www.olehammersland.com/blogg/effektivisering/">#effektivisering</a>
  
  <a href="https://www.olehammersland.com/blogg/enkeltpersonforetak/">#enkeltpersonforetak</a>
  
  <a href="https://www.olehammersland.com/blogg/oversettelse/">#oversettelse</a>
  
  <a href="https://www.olehammersland.com/blogg/python/">#python</a>
  
</p>



  </main>
  <footer>Kontakt: <a href="mailto:post@olehammersland">post@olehammersland.com</a>
</footer>

  
  <script src=/bundle.js></script>
</body>

</html>
